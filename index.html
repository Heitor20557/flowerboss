<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cuphead Boss Fight - Cagney Carnation</title>
    <style>
        body { margin: 0; background: #1a1a1a; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Arial', sans-serif; }
        canvas { background: #5c940d; border: 4px solid #333; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
        #hud { position: absolute; top: 10px; color: white; text-align: center; width: 100%; font-weight: bold; font-size: 20px; pointer-events: none; }
    </style>
</head>
<body>

<div id="hud">
    HP: <span id="hp" style="color: #ff4d4d;">3</span> | 
    BOSS: <span id="boss-hp" style="color: #ffcc00;">100</span>%
</div>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = 800;
canvas.height = 450;

// Configurações
const GRAVITY = 0.6;
const keys = {};

// Gerenciador de Input (Corrigido para evitar erros de maiúsculas/minúsculas)
window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

class Player {
    constructor() {
        this.x = 100; this.y = 300;
        this.w = 30; this.h = 50;
        this.vx = 0; this.vy = 0;
        this.speed = 5;
        this.jumpPower = -12;
        this.grounded = false;
        this.hp = 3;
        this.shootTimer = 0;
    }

    update() {
        // Movimento
        if (keys['ArrowLeft']) this.vx = -this.speed;
        else if (keys['ArrowRight']) this.vx = this.speed;
        else this.vx = 0;

        // Pulo (Tecla Z)
        if (keys['KeyZ'] && this.grounded) {
            this.vy = this.jumpPower;
            this.grounded = false;
        }

        // Aplicar Física
        this.vy += GRAVITY;
        this.x += this.vx;
        this.y += this.vy;

        // Chão
        if (this.y + this.h > canvas.height - 30) {
            this.y = canvas.height - 30 - this.h;
            this.vy = 0;
            this.grounded = true;
        }

        // Limites da tela
        if (this.x < 0) this.x = 0;
        if (this.x + this.w > canvas.width) this.x = canvas.width - this.w;

        if (this.shootTimer > 0) this.shootTimer--;
    }

    draw() {
        ctx.fillStyle = 'red'; // Cuphead
        ctx.fillRect(this.x, this.y, this.w, this.h);
        // "Cabeça" da xícara
        ctx.fillStyle = 'white';
        ctx.fillRect(this.x - 5, this.y - 10, this.w + 10, 20);
    }
}

class Boss {
    constructor() {
        this.x = 600; this.y = 150;
        this.w = 120; this.h = 220;
        this.hp = 100;
        this.attackTimer = 0;
    }

    update() {
        this.attackTimer++;
        if (this.attackTimer % 90 === 0) { // Ataca a cada 1.5 segundos
            this.shoot();
        }
    }

    shoot() {
        // Boss atira sementes (projéteis laranjas)
        bossProjectiles.push(new Projectile(this.x, this.y + 50, -6, 'orange', 15));
    }

    draw() {
        // Desenha a Flor (Cagney)
        ctx.fillStyle = this.hp < 30 ? '#5a2d0c' : '#ff9800'; 
        ctx.beginPath();
        ctx.arc(this.x + 60, this.y + 60, 60, 0, Math.PI * 2);
        ctx.fill();
        // Caule
        ctx.fillStyle = '#2d5a27';
        ctx.fillRect(this.x + 50, this.y + 120, 20, 200);
    }
}

class Projectile {
    constructor(x, y, vx, color, size) {
        this.x = x; this.y = y;
        this.vx = vx; this.color = color;
        this.size = size;
    }
    update() { this.x += this.vx; }
    draw() {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.size, this.size);
    }
}

// Instâncias
const player = new Player();
const boss = new Boss();
const playerProjectiles = [];
const bossProjectiles = [];
const platforms = [
    {x: 100, y: 280, w: 80, h: 15},
    {x: 250, y: 220, w: 80, h: 15},
    {x: 400, y: 280, w: 80, h: 15}
];

function checkCollision(r1, r2) {
    return r1.x < r2.x + (r2.w || r2.size) &&
           r1.x + (r1.w || r1.size) > r2.x &&
           r1.y < r2.y + (r2.h || r2.size) &&
           r1.y + (r1.h || r1.size) > r2.y;
}

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Fundo simples (Grama)
    ctx.fillStyle = '#3e6b0a';
    ctx.fillRect(0, canvas.height - 30, canvas.width, 30);

    // Plataformas
    ctx.fillStyle = '#ff69b4'; // Rosa para Parry
    platforms.forEach(p => {
        ctx.fillRect(p.x, p.y, p.w, p.h);
        // Colisão com plataforma
        if (player.vy > 0 && checkCollision(player, p) && (player.y + player.h) < p.y + 20) {
            player.y = p.y - player.h;
            player.vy = 0;
            player.grounded = true;
        }
    });

    // Player Atacar (Tecla X)
    if (keys['KeyX'] && player.shootTimer === 0) {
        playerProjectiles.push(new Projectile(player.x + player.w, player.y + 15, 10, 'cyan', 8));
        player.shootTimer = 10;
    }

    // Atualizar Player e Boss
    player.update();
    boss.update();

    // Lógica de Projéteis do Player
    playerProjectiles.forEach((p, i) => {
        p.update();
        p.draw();
        if (checkCollision(p, boss)) {
            boss.hp -= 1;
            playerProjectiles.splice(i, 1);
            document.getElementById('boss-hp').innerText = Math.max(0, boss.hp);
        }
        if (p.x > canvas.width) playerProjectiles.splice(i, 1);
    });

    // Lógica de Projéteis do Boss (Dano no Player)
    bossProjectiles.forEach((p, i) => {
        p.update();
        p.draw();
        if (checkCollision(p, player)) {
            player.hp -= 1;
            bossProjectiles.splice(i, 1);
            document.getElementById('hp').innerText = player.hp;
            if (player.hp <= 0) alert("YOU DIED!");
        }
        if (p.x < 0) bossProjectiles.splice(i, 1);
    });

    player.draw();
    boss.draw();

    if (boss.hp > 0) requestAnimationFrame(loop);
    else alert("KNOCKOUT! Você venceu a flor!");
}

loop();
</script>
</body>
</html>
