<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Floral Fury - Cuphead Clone</title>
    <style>
        body { margin: 0; background: #1a1a1a; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Trebuchet MS', sans-serif; }
        canvas { background: #5c8cae; border: 8px solid #222; border-radius: 10px; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        #ui { position: absolute; top: 30px; left: 30px; color: #ff3e3e; font-size: 28px; font-weight: bold; text-shadow: 2px 2px #000; pointer-events: none; display: none; }
    </style>
</head>
<body>

<div id="ui">HP: <span id="hp-val">3</span></div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 800;
canvas.height = 450;

// Estados do Jogo: 'MENU' ou 'PLAYING'
let gameState = 'MENU';
const keys = {};

window.addEventListener('keydown', e => {
    keys[e.code] = true;
    if (gameState === 'MENU' && e.code === 'Enter') {
        gameState = 'PLAYING';
        document.getElementById('ui').style.display = 'block';
    }
});
window.addEventListener('keyup', e => keys[e.code] = false);

// --- Entidades ---
const player = {
    x: 150, y: 300, w: 40, h: 55, vx: 0, vy: 0, 
    speed: 5, jump: -14, grounded: false, hp: 3,
    shootTimer: 0, special: 0, invul: 0
};

const boss = {
    x: 550, y: 80, w: 200, h: 320, hp: 100, 
    color: '#ff8c00', attackTimer: 0
};

const pBullets = []; // Balas do Player
const bBullets = []; // Ataques do Boss (Folhas)
const platforms = [
    {x: 80, y: 320, w: 100, h: 20},
    {x: 250, y: 250, w: 100, h: 20},
    {x: 420, y: 320, w: 100, h: 20}
];

// --- Funções Auxiliares ---
function checkRectCollision(a, b) {
    return a.x < b.x + b.w && a.x + (a.w || 10) > b.x &&
           a.y < b.y + b.h && a.y + (a.h || 10) > b.y;
}

function drawMenu() {
    ctx.fillStyle = '#5c8cae';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Grama e Nuvens do Menu
    ctx.fillStyle = '#4e7a2a';
    ctx.fillRect(0, canvas.height - 40, canvas.width, 40);
    
    ctx.fillStyle = 'rgba(255,255,255,0.7)';
    ctx.beginPath(); ctx.arc(200, 100, 40, 0, Math.PI*2); ctx.fill(); // Nuvem

    ctx.fillStyle = '#ffcc00';
    ctx.font = 'bold 60px "Arial Black"';
    ctx.textAlign = 'center';
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 4;
    ctx.strokeText('FLORAL FURY', canvas.width/2, 180);
    ctx.fillText('FLORAL FURY', canvas.width/2, 180);

    ctx.fillStyle = 'white';
    ctx.font = '20px Arial';
    ctx.fillText('PRESS ENTER TO START', canvas.width/2, 300);
    ctx.font = '16px Arial';
    ctx.fillText('Z/Setas: Move | Space: Jump | X: Shoot | C: Dash', canvas.width/2, 340);
}

function update() {
    if (gameState !== 'PLAYING') return;

    // Movimentação Player (Z ou Setas)
    if (keys['ArrowLeft']) player.vx = -player.speed;
    else if (keys['ArrowRight']) player.vx = player.speed;
    else player.vx = 0;

    if ((keys['Space'] || keys['KeyZ']) && player.grounded) {
        player.vy = player.jump;
        player.grounded = false;
    }

    player.vy += 0.7; // Gravidade
    player.x += player.vx;
    player.y += player.vy;

    // Colisão Chão
    if (player.y + player.h > canvas.height - 40) {
        player.y = canvas.height - 40 - player.h;
        player.vy = 0;
        player.grounded = true;
    }

    // Colisão Plataformas
    platforms.forEach(p => {
        if (player.vy > 0 && checkRectCollision(player, p) && player.y + player.h < p.y + 20) {
            player.y = p.y - player.h;
            player.vy = 0;
            player.grounded = true;
        }
    });

    // Tiro (X) - CORREÇÃO DE DANO
    if (keys['KeyX'] && player.shootTimer <= 0) {
        pBullets.push({x: player.x + player.w, y: player.y + 20, w: 15, h: 8});
        player.shootTimer = 10;
    }
    if (player.shootTimer > 0) player.shootTimer--;

    pBullets.forEach((b, i) => {
        b.x += 12;
        // Se a bala encostar na área do Boss (Retângulo invisível de colisão)
        if (checkRectCollision(b, boss)) {
            boss.hp -= 1.5;
            pBullets.splice(i, 1);
        }
        if (b.x > canvas.width) pBullets.splice(i, 1);
    });

    // Boss Ataca (Lança folhas)
    boss.attackTimer++;
    if (boss.attackTimer % 80 === 0) {
        const angle = Math.atan2(player.y - 150, player.x - boss.x);
        bBullets.push({x: boss.x, y: 150, vx: Math.cos(angle)*6, vy: Math.sin(angle)*6, w: 20, h: 10});
    }

    bBullets.forEach((b, i) => {
        b.x += b.vx; b.y += b.vy;
        if (checkRectCollision(b, player) && player.invul <= 0) {
            player.hp--;
            player.invul = 60;
            document.getElementById('hp-val').innerText = player.hp;
            bBullets.splice(i, 1);
        }
        if (b.x < 0 || b.y > canvas.height) bBullets.splice(i, 1);
    });

    if (player.invul > 0) player.invul--;
    if (player.hp <= 0) location.reload();
}

function draw() {
    if (gameState === 'MENU') {
        drawMenu();
    } else {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Fundo e Grama
        ctx.fillStyle = '#5c8cae'; ctx.fillRect(0,0, canvas.width, canvas.height);
        ctx.fillStyle = '#4e7a2a'; ctx.fillRect(0, canvas.height - 40, canvas.width, 40);

        // Plataformas (Cogumelos Rosa)
        ctx.fillStyle = '#ff69b4';
        platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));

        // Boss (Inspirado na Cagney Carnation)
        ctx.fillStyle = '#2d5a27'; ctx.fillRect(boss.x + 80, 200, 30, 250); // Caule
        ctx.fillStyle = boss.hp < 40 ? '#8b0000' : '#ff8c00'; // Muda cor na fase final
        ctx.beginPath(); ctx.arc(boss.x + 95, 150, 90, 0, Math.PI*2); ctx.fill(); // Pétalas
        ctx.fillStyle = '#f7e442'; ctx.fillRect(boss.x + 55, 110, 80, 80); // Rosto

        // Player
        ctx.fillStyle = player.invul % 4 > 1 ? 'transparent' : 'red';
        ctx.fillRect(player.x, player.y, player.w, player.h);

        // Tiros
        ctx.fillStyle = '#00f2ff'; pBullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));
        ctx.fillStyle = '#46aa2d'; bBullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));

        // Vitória
        if (boss.hp <= 0) {
            ctx.fillStyle = 'white'; ctx.font = '60px Arial'; ctx.textAlign = 'center';
            ctx.fillText('KNOCKOUT!', canvas.width/2, 220);
        }
    }
    requestAnimationFrame(() => { update(); draw(); });
}

draw();
</script>
</body>
</html>
